# 명세

'찰떡' 프로그램은 다음 요소로 구성된 문자열입니다.
- 어휘 정의문
- 구문 정의문
- 표현식
- 주석

'찰떡' 실행기는 어휘 정의문과 구문 정의문을 바탕으로 어휘 분석기와 구문 분석기를 구성하여 표현식을 해석합니다.

## 주석
주석은 다음 형식과 같이 짝이 맞는 소괄호로 묶인 문자열입니다.

    (주석 내용)

주석 안에 다시 소괄호가 있을 수 있습니다. 그러한 경우 주석 안의 소괄호 역시 짝을 맞춰야 합니다.

예:
```
주석 바깥 ( 주석 안 ( 주석 안 ) 주석 안 ) 주석 바깥
```

주석 안에는 줄바꿈이 들어갈 수 있습니다.

예:
```
(
    주석
)
```


## 어휘 정의문
어휘 정의문은 어휘 분석기에 어휘를 등록하기 위한 구문입니다. 어휘를 어휘 분석기에 등록하지 않으면 표현식에서 해당 어휘를 사용하려고 할 때 분석에 실패합니다.

어휘 정의문은 다음과 같은 형식의 문자열입니다. 어휘 정의문은 줄이 바뀌면 끝납니다.

    기본형 [품사] 문법 정보

기본형은 정의하려는 어휘의 기본이 되는 형태로, 사전의 표제어를 올릴 때 사용되는 것과 같습니다. 예를 들어, 동사 '나누다, 나눠, 나누니'의 기본형은 '나누다'입니다.

품사는 다음 8가지를 사용할 수 있습니다.
- `[명사]`
- `[동사]`
- `[형용사]`
- `[관형사]`
- `[부사]`
- `[조사]`
- `[어미]`
- `[접미사]`

동사와 형용사, 어미는 문법 정보가 필요할 때가 있습니다. 그밖의 품사는 문법 정보를 적지 않습니다.

### 동사와 형용사
동사와 형용사는 활용형을 다음 형식에 맞춰 문법 정보에 적습니다.

> 기본형 [품사] -아/어꼴, -으니꼴

예:
- `같다 [형용사] 같아, 같으니`
- `크다 [형용사] 커, 크니`
- `다르다 [형용사] 달라, 다르니`

활용형이 여러 가지로 나타날 수 있는 경우 빗금표(`/`)로 구분합니다.

예:
- `제곱하다 [동사] 제곱하여/제곱해, 제곱하니`
- `두다 [동사] 두어/둬, 두니`

규칙 용언의 경우 활용형을 생략할 수 있습니다.

예:
- `많다 [형용사]`
- `적다 [형용사]`

### 조사
조사는 선행하는 단어의 받침에 따라 그 형태가 달라질 수 있습니다.
그러한 경우 다음 형식을 따릅니다.

    받침이 있을 때/받침이 없을 때 [조사]

예:
- `은/는 [조사]`
- `이/가 [조사]`
- `을/를 [조사]`

조사의 형태가 선행하는 단어의 받침과 무관하다면 그 형태만 적습니다.

예:
- `에 [조사]`
- `의 [조사]`

### 어미
어미는 기본형의 앞에 붙임표(`-`)를 덧붙이며, 선행하는 용언이 받침으로 끝나는 경우의 형태를 적습니다.

예:
- `-거나 [어미]` (많거나, 적거나, ...)
- `-어서 [어미]` (많아서, 적어서, ...)
- `-으면 [어미]` (많으면, 적으면, ...)

받침이 있을 때의 형태만으로 받침이 없을 때의 형태를 알기 어려운 경우 다음 형식에 따라 둘 모두 적습니다.

> -받침이 있을 때/받침이 없을 때 [어미]

예:
- `-는다/ㄴ다 [어미]`

소괄호를 사용하면 주석으로 해석되니 주의가 필요합니다.
예를 들어, 다음 세 어휘 정의문은 동일합니다.
- `-나 [어미]`
- `-(으)나 [어미]`
- `-(임의의 주석)나 [어미]`

어미의 앞에 올 수 있는 단어의 종류에 제한이 있는 경우 다음 형식에 따라 문법 정보에 적습니다.
제한이 없는 경우 문법 정보를 생략합니다.

> 기본형 [어미] 종류[, 종류, ...] 뒤에

제한을 걸 수 있는 종류는 다음과 같습니다.
- 동사
- 형용사
- 이다
- 아니다
- 있다
- 없다

예:
- `-는 [어미] 있다, 없다, 동사 뒤에`

## 구문 정의문

구문 정의문은 구문 분석기에 구문을 등록하기 위한 구문입니다. 구문을 구문 분석기에 등록하지 않으면 표현식에서 해당 구문을 사용하려고 할 때 분석에 실패합니다.

구문 정의문은 다음과 같은 형식의 문자열입니다. 구문 정의문은 줄바꿈을 두 번 하여 끝납니다. 구문과 구문, 구문과 표현식 사이에는 임의의 공백과 임의 개수의 줄바꿈이 들어갈 수 있습니다. 표현식과 표현식 사이에는 임의의 공백과 최대 한 개의 줄바꿈이 들어갈 수 있습니다.

```
구문 1:
구문 2:
...
구문 n:

표현식 1.
표현식 2.
...
표현식 m.


```

(TODO)

## 표현식

표현식은 마침표로 끝나는 문장으로 이루어진 문자열입니다.
문장은 공백으로 구분된 여러 어절로 이루어집니다. 어절은 다음과 같이 중심 단어에 여러 조사, 어미, 접미사가 선택적으로 결합한 형태입니다.

* `삼천이백` <- `삼천이백` (중심 단어)
* `다섯제곱의` <- `다섯` (중심 단어) + `-제곱` (접미사) + `의` (조사)
* `더하자` <- `더하다` (중심 단어) + `-자` (어미)

'찰떡'에서 중심 단어는 명사, 동사, 형용사, 관형사, 부사의 다섯 가지 품사를 지닌 단어가 올 수 있으며, 명사는 접미사와 조사, 동사와 형용사는 어미에 결합할 수 있습니다.

한국어에서와 마찬가지로 단어에 조사와 어미를 적절히 결합하여 다른 품사로 전환할 수 있습니다.

* 명사 + `이다` → 형용사
* 명사 + `의` → 관형사
* 명사 + `이(가)`, `을(를)`, ... → 부사

* 동사/형용사 + `-(으)ㅁ` → 명사
* 동사/형용사 + `-(으)ㄴ` → 관형사

### 수사
'찰떡'은 다음과 같은 형식의 수사를 인식합니다.

* 쉼표로 구분된 인도-아라비아 숫자
  + 예: `0.12`, `+12,345,678.900`
* 지수 표기법
  + 예: `−1.602e−19`
* 만의 자리에서 띄어쓴 한자어 수사
  + 예: `일억 이천삼백사십오만 육천칠백팔십구`
* 십의 자리마다 인도-아라비아 숫자를 적은 한자어 수사
  + 예: `1억 2천3백4십5만 6천7백8십9`
* 만의 자리마다 인도-아라비아 숫자를 적은 한자어 수사
  + 예: `1억 2345만 6789`

`...의 ...제곱` 꼴의 두번째 인수에 한해 순우리말 수사도 함께 인식합니다.
* 예: `10의 세제곱`

### 단어 결합 규칙
한국어와 같은 자연어는 같은 문장이 여러가지 의미로 읽힐 수 있는 중의성이 있습니다. 특히 다음과 같이 단어를 결합하는 순서에 따라 다른 의미를 지니는 구조적 중의성을 생각할 수 있습니다.

![머리가 빨간 생선을 먹는 고양이](https://pbs.twimg.com/media/BnqSR2IIEAAIPW4?format=png&name=medium)
(그림 출처: [트위터 @kjoonlee](https://twitter.com/kjoonlee/status/466846348541558784))

'찰떡'에서는 기본적으로 앞쪽의 단어부터 먼저 결합하는 좌결합 방식을 채택하고 있습니다. 쉼표(`,`)를 사용하면 쉼표 앞뒤 구절의 결합을 문장이 끝나거나 다음 쉼표를 만나기 전까지 최대한 후순위로 미룹니다.

* `2분의 5분의 1.` → `0.4`
  + 가장 앞에 있는 `2분의 5`가 먼저 결합됩니다.
* `2분의, 5분의 1.` → `0.1`
  + 뒤에 있는 `5분의 1`이 먼저 결합됩니다.

특히 결합 순서로 인해 유효한 문장이 만들어지지 않는 경우 다음과 같이 쉼표를 사용해 원하는 결합 순서를 강제해야 합니다.
* `1과 2의 곱과 3과 4의 곱의 합.`
  + `1과 2의 곱과 3과 4`가 먼저 결합합니다. `합`은 두 개 이상의 인수를 요구하기 때문에 구문 분석 오류가 발생합니다.
* `1과 2의 곱과, 3과 4의 곱의, 합.`
  + `1과 2의 곱` 및 `3과 4의 곱`이 각자 먼저 결합합니다. 원하는 결과 `14`를 얻습니다.


### 자료형
'찰떡'에서 객체는 `'수'`, `'정수'`, `'참거짓'`, `'나눔'`이라는 네 가지 자료형을 지닙니다. `'수'`와 `'정수'`는 앞서 설명한 수사로, `'참거짓'`은 `참`, `거짓`이라는 단어로 생성할 수 있습니다.

`'나눔'`은 `'수'로 '수'를 나누다`와 같은 연산으로 나눗셈을 수행한 결과로 얻는 자료형입니다. `'나눔'의 값`, `'나눔'의 나머지`, `'나눔'의 몫` 연산으로 각각 실수 나눗셈 결과, 정수 나눗셈의 몫, 정수 나눗셈의 나머지를 얻을 수 있습니다.

### 변수
'찰떡'에서 변수의 이름은 `'결과'`처럼 따옴표(`'...'`)로 감싼, 공백을 포함하지 않는 문자열로 표기합니다. 이 규칙은 변수를 선언할 때와 사용할 때 모두 적용됩니다.

### 인수 생략
특정 연산의 경우 인수를 생략하면 이전 연산의 결과를 가져와 해당 인수로 전달할 수 있습니다. 인수는 한 개까지만 생략할 수 있습니다. 

인수 생략 시 전달할 값을 지정하려면 어미 `-(아/어)`를 사용합니다.

예를 들어 다음 두 문장은 같은 의미입니다.
* `1과 2를 더해 3에서 뺀 값`
* `3에서 1과 2를 더한 것을 뺀 값`

## 기본 제공 기능
[기본 제공 기능 일람](./builtin/general.md) 문서를 참조해주세요.
 
